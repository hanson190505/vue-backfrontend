(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2dd2d7ae"],{"1e9e":function(e,t,r){"use strict";var a=r("50a1"),o=r.n(a);o.a},"37e1":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return s}));var a=r("6128");function o(){Object(a["a"])({baseURL:"http://192.168.3.45:8000/orders/",params:{token:window.sessionStorage.getItem("token"),st:"addorder"}}).then((function(e){window.sessionStorage.setItem("subtoken",e.data.subtoken)}))}function s(){window.sessionStorage.removeItem("subtoken")}},"50a1":function(e,t,r){},a434:function(e,t,r){"use strict";var a=r("23e7"),o=r("23cb"),s=r("a691"),i=r("50c4"),n=r("7b0b"),l=r("65f0"),d=r("8418"),u=r("1dde"),c=r("ae40"),m=u("splice"),p=c("splice",{ACCESSORS:!0,0:0,1:2}),b=Math.max,f=Math.min,_=9007199254740991,h="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!m||!p},{splice:function(e,t){var r,a,u,c,m,p,v=n(this),w=i(v.length),g=o(e,w),y=arguments.length;if(0===y?r=a=0:1===y?(r=0,a=w-g):(r=y-2,a=f(b(s(t),0),w-g)),w+r-a>_)throw TypeError(h);for(u=l(v,a),c=0;c<a;c++)m=g+c,m in v&&d(u,c,v[m]);if(u.length=a,r<a){for(c=g;c<w-a;c++)m=c+a,p=c+r,m in v?v[p]=v[m]:delete v[p];for(c=w;c>w-a+r;c--)delete v[c-1]}else if(r>a)for(c=w-a;c>g;c--)m=c+a-1,p=c+r-1,m in v?v[p]=v[m]:delete v[p];for(c=0;c<r;c++)v[c+g]=arguments[c+2];return v.length=w-a+r,u}})},aee6:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"order-detail"},[r("el-card",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),r("el-breadcrumb-item",{attrs:{to:{path:"/orders"}}},[e._v("订单管理")]),r("el-breadcrumb-item",[e._v("订单明细")])],1),r("el-form",{ref:"form",attrs:{model:e.orderdetail,"label-width":"80px",size:"mini","inline-message":""}},[r("el-row",[r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"订单编号",prop:"order_number"}},[r("el-input",{attrs:{disabled:""},model:{value:e.orderdetail.order_number,callback:function(t){e.$set(e.orderdetail,"order_number",t)},expression:"orderdetail.order_number"}})],1)],1),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"客户名称"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择",disabled:e.formdisabl},on:{"visible-change":e.selectTest},model:{value:e.orderdetail.customer,callback:function(t){e.$set(e.orderdetail,"customer",t)},expression:"orderdetail.customer"}},e._l(e.customerData,(function(e){return r("el-option",{key:e.lite_name,attrs:{label:e.lite_name,value:e.lite_name}})})),1)],1)],1),r("el-col",{attrs:{span:4}},[r("el-form-item",{attrs:{label:"汇率",prop:"ex_rate"}},[r("el-input",{attrs:{disabled:e.formdisabl},model:{value:e.orderdetail.ex_rate,callback:function(t){e.$set(e.orderdetail,"ex_rate",t)},expression:"orderdetail.ex_rate"}})],1)],1),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"完成状态",prop:"is_done"}},[r("el-select",{attrs:{size:"mini",clearable:"",disabled:e.formdisabl},model:{value:e.orderdetail.is_done,callback:function(t){e.$set(e.orderdetail,"is_done",t)},expression:"orderdetail.is_done"}},e._l(e.Options,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"下单日期"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",disabled:e.formdisabl},model:{value:e.orderdetail.order_date,callback:function(t){e.$set(e.orderdetail,"order_date",t)},expression:"orderdetail.order_date"}})],1)],1),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"订单交期"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",disabled:e.formdisabl},model:{value:e.orderdetail.deliver_date,callback:function(t){e.$set(e.orderdetail,"deliver_date",t)},expression:"orderdetail.deliver_date"}})],1)],1),r("el-col",{attrs:{span:4}},[r("el-form-item",{attrs:{label:"金额($)"}},[r("el-input",{attrs:{disabled:""},model:{value:e.orderdetail.order_amount,callback:function(t){e.$set(e.orderdetail,"order_amount",t)},expression:"orderdetail.order_amount"}})],1)],1),r("el-col",{attrs:{span:4}},[r("el-form-item",{attrs:{label:"金额(¥)"}},[r("el-input",{attrs:{disabled:""},model:{value:e.rmbOrderAmount,callback:function(t){e.rmbOrderAmount=t},expression:"rmbOrderAmount"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"出货地址"}},[r("el-input",{attrs:{disabled:e.formdisabl},model:{value:e.orderdetail.ship_addr,callback:function(t){e.$set(e.orderdetail,"ship_addr",t)},expression:"orderdetail.ship_addr"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{disabled:e.formdisabl},model:{value:e.orderdetail.text,callback:function(t){e.$set(e.orderdetail,"text",t)},expression:"orderdetail.text"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-upload",{staticClass:"upload-demo",attrs:{action:"http://0.0.0.0:8000/upload/","on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-success":e.uploadSuccess,"file-list":e.fileList,limit:1,"before-upload":e.handlebeforeupload,data:e.uploadData,accept:"image/jpg, image/jpeg, image/png"}},[r("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("点击上传")]),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")])],1)],1),r("el-col",{attrs:{span:16}},[r("div",{staticClass:"order-img"},[r("img",{staticClass:"orderImg",attrs:{src:this.orderdetail.order_pic},on:{click:e.imgLook}})])])],1)],1),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.editOrder,expression:"editOrder"}],attrs:{type:"primary"},on:{click:e.editOrderDetail}},[e._v("修改订单")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.saveOrder,expression:"saveOrder"}],attrs:{type:"warning"},on:{click:e.saveOrderDetail}},[e._v("保存订单")]),r("el-button",{attrs:{type:"primary"},on:{click:e.addSubOrderRow}},[e._v("新增明细")]),r("el-button",{attrs:{type:"primary"},on:{click:e.purchaseDetail}},[e._v("采购详情")]),r("el-button",{attrs:{type:"primary"},on:{click:e.shipDetail}},[e._v("出货详情")]),r("el-table",{staticStyle:{width:"99.9%"},attrs:{data:e.suborderdetail,"show-summary":"","highlight-current-row":""}},[r("el-table-column",{attrs:{label:"产品名称",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?r("el-input",{attrs:{size:"mini"},model:{value:t.row.pro_name,callback:function(r){e.$set(t.row,"pro_name",r)},expression:"scope.row.pro_name"}}):r("span",[e._v(e._s(t.row.pro_name))])]}}])}),r("el-table-column",{attrs:{label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?r("el-select",{attrs:{size:"mini",clearable:"",placeholder:"请选择"},model:{value:t.row.pro_item,callback:function(r){e.$set(t.row,"pro_item",r)},expression:"scope.row.pro_item"}},e._l(e.options,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):r("span",[e._v(e._s(e.options[t.row.pro_item-1].label))])]}}])}),r("el-table-column",{attrs:{label:"描述",width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?r("el-input",{attrs:{size:"mini",type:"textarea",autosize:""},model:{value:t.row.pro_desc,callback:function(r){e.$set(t.row,"pro_desc",r)},expression:"scope.row.pro_desc"}}):r("span",[e._v(e._s(t.row.pro_desc))])]}}])}),r("el-table-column",{attrs:{label:"数量",prop:"pro_qt",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?r("el-input",{attrs:{size:"mini"},model:{value:t.row.pro_qt,callback:function(r){e.$set(t.row,"pro_qt",r)},expression:"scope.row.pro_qt"}}):r("span",[e._v(e._s(t.row.pro_qt))])]}}])}),r("el-table-column",{attrs:{label:"单价($)",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?r("el-input",{attrs:{size:"mini"},on:{blur:function(r){return e.subAmount(t.row)}},model:{value:t.row.pro_price,callback:function(r){e.$set(t.row,"pro_price",r)},expression:"scope.row.pro_price"}}):r("span",[e._v(e._s(t.row.pro_price))])]}}])}),r("el-table-column",{attrs:{label:"重量(g)",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?r("el-input",{attrs:{size:"mini"},model:{value:t.row.pro_weight,callback:function(r){e.$set(t.row,"pro_weight",r)},expression:"scope.row.pro_weight"}}):r("span",[e._v(e._s(t.row.pro_weight))])]}}])}),r("el-table-column",{attrs:{label:"金额($)",prop:"sub_amount",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?r("el-input",{attrs:{size:"mini"},model:{value:t.row.sub_amount,callback:function(r){e.$set(t.row,"sub_amount",r)},expression:"scope.row.sub_amount"}}):r("span",[e._v(e._s(t.row.sub_amount))])]}}])}),r("el-table-column",{attrs:{label:"操作",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.editOrder,expression:"editOrder"}],attrs:{type:"text"},on:{click:function(r){return e.editSubOrderRow(t.$index,t.row)}}},[e._v("修改")]),r("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(r){return e.delSubOrderRow(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),r("el-button",{attrs:{type:"primary"},on:{click:e.firstSaveSuborder}},[e._v("提交修改")]),r("el-dialog",{attrs:{visible:e.imgdialogVisible,width:"96%"},on:{"update:visible":function(t){e.imgdialogVisible=t}}},[r("div",[r("img",{attrs:{src:e.orderdetail.order_pic,width:"99%"}})])])],1)],1)},o=[],s=(r("a4d3"),r("e01a"),r("d28b"),r("4160"),r("a434"),r("d3b7"),r("3ca3"),r("159b"),r("ddb0"),r("f6b0")),i=r("37e1"),n=r("f8b7"),l={name:"OrderDetail",data:function(){return{btn:"btn",formdisabl:!0,orderdetail:{order_number:"",customer:"",order_date:"",deliver_date:"",ex_rate:0,order_amount:0,ship_addr:"",text:"",order_pic:""},rmbOrderAmount:0,suborderdetail:[],customerData:[],editSubOrder:!0,saveSubOrder:!1,editOrder:!0,saveOrder:!1,options:[{value:1,label:"硅胶"},{value:2,label:"五金"},{value:3,label:"USB"},{value:4,label:"移动电源"},{value:5,label:"其他"}],Options:[{value:1,label:"未完成"},{value:2,label:"已完成"},{value:3,label:"已超期"}],fileList:[],imgdialogVisible:!1,uploadData:{token:window.sessionStorage.getItem("token")}}},methods:{selectTest:function(e){var t=this;!0===e&&Object(s["a"])().then((function(e){t.customerData=e.data}))},editOrderDetail:function(){this.formdisabl=!1,this.editOrder=!1,this.saveOrder=!0,this.uploadbtnstatus=!1,console.log("修改订单")},handleRemove:function(){},beforeRemove:function(){},uploadSuccess:function(e){this.uploadbtnstatus=!0,this.orderdetail.order_pic="http://192.168.3.45:8000"+e.file},handlebeforeupload:function(){},imgLook:function(){this.imgdialogVisible=!0},saveOrderDetail:function(){var e=this;this.formdisabl=!0,this.editOrder=!0,this.saveOrder=!1,Object(n["d"])(this.orderdetail.order_number,"",this.orderdetail).then((function(t){e.$message("订单修改成功")})).catch((function(t){e.$message("网络错误,刷新重试")}))},sumOrderAmount:function(){var e=0,t=!0,r=!1,a=void 0;try{for(var o,s=this.suborderdetail[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var i=o.value;e+=1*i.sub_amount}}catch(n){r=!0,a=n}finally{try{t||null==s.return||s.return()}finally{if(r)throw a}}this.orderdetail.order_amount=e,this.rmbOrderAmount=e*this.orderdetail.ex_rate*1},subAmount:function(e){e.sub_amount=e.pro_price*e.pro_qt*1},firstSaveSuborder:function(){var e=this;this.sumOrderAmount(),window.sessionStorage.getItem("subtoken")?this.suborderdetail.forEach((function(t){t.hasOwnProperty("id")?1===t.status&&Object(n["e"])(t.id,"",t).then((function(){t.status=0,e.saveOrderDetail()})):(t.status=0,Object(n["g"])(t).then((function(t){e.saveOrderDetail()})).catch((function(t){var r=e.$createElement;e.$notify({title:"警告",message:r("i",{style:"color: teal"},"网络错误,请刷新重试")})})))})):this.$message.error("请勿重复提交,或刷新重试"),window.sessionStorage.removeItem("subtoken")},addSubOrderRow:function(e){var t={pro_name:"",pro_item:1,pro_desc:"",pro_qt:0,pro_price:0,pro_weight:0,order_number:this.orderdetail.order_number,sub_amount:0,status:1};this.suborderdetail.push(t)},editSubOrderRow:function(e,t){t.status=1},delSubOrderRow:function(e,t){var r=this;t.hasOwnProperty("id")?this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){console.log(e),console.log(t),r.suborderdetail.splice(e,1),Object(n["e"])(t.id,"",{is_delete:0}).then((function(e){r.$message({type:"success",message:"删除成功!"})}))})).catch((function(){r.$message({type:"info",message:"已取消删除"})})):this.$confirm("数据未保存,确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r.suborderdetail.splice(e,1),r.$message({type:"success",message:"删除成功!"})})).catch((function(){r.$message({type:"info",message:"已取消删除"})}))},purchaseDetail:function(){},shipDetail:function(){}},beforeCreate:function(){var e=this,t=window.sessionStorage.getItem("order_number");Object(n["a"])(t).then((function(r){e.orderdetail=r.data,Object(n["c"])({order_number:t}).then((function(t){e.suborderdetail=t.data,t.data.forEach((function(e){e.status=0})),t.data.length}))})),Object(i["b"])()}},d=l,u=(r("1e9e"),r("2877")),c=Object(u["a"])(d,a,o,!1,null,"666f1f74",null);t["default"]=c.exports},f6b0:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return n}));var a=r("6128"),o=r("4328"),s=r.n(o);function i(e){return Object(a["a"])({url:"customers/",method:"post",params:{subtoken:window.sessionStorage.getItem("subtoken")},data:s.a.stringify(e)})}function n(e){return Object(a["a"])({url:"customers/",params:e})}},f8b7:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return n})),r.d(t,"f",(function(){return l})),r.d(t,"d",(function(){return d})),r.d(t,"c",(function(){return u})),r.d(t,"e",(function(){return c})),r.d(t,"g",(function(){return m}));var a=r("6128"),o=r("4328"),s=r.n(o);function i(e){return Object(a["a"])({url:"orders/",params:e})}function n(e,t){return Object(a["a"])({url:"orders/".concat(e,"/"),params:t})}function l(e){return Object(a["a"])({url:"orders/",method:"post",params:{subtoken:window.sessionStorage.getItem("subtoken")},data:s.a.stringify(e)})}function d(e,t,r){return Object(a["a"])({url:"orders/".concat(e,"/"),method:"patch",params:t,data:s.a.stringify(r)})}function u(e){return Object(a["a"])({url:"suborders/",params:e})}function c(e,t,r){return Object(a["a"])({url:"suborders/".concat(e,"/"),method:"patch",params:t,data:s.a.stringify(r)})}function m(e){return Object(a["a"])({url:"suborders/",method:"post",params:{subtoken:window.sessionStorage.getItem("subtoken")},data:s.a.stringify(e)})}}}]);
//# sourceMappingURL=chunk-2dd2d7ae.40dd8247.js.map